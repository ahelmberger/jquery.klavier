/*! jquery.klavier - v0.9.0 - 2014-03-10
* https://github.com/learningmedia/jquery.klavier
* Copyright (c) 2014 Andreas Helmberger & Ulrich Kaiser; Licensed MIT */
(function(e,t){var i=0,s=120,r=.6,n=.6,a="klavier",o=[1,3,6,8,10],l=function(e,t){e.css("position","relative").addClass(t.cssPrefix+"-container").on("click."+a,"."+t.cssPrefix+"-key",d)},c=function(t,i){var s,a,o=u.getWhiteKeyCount(i.startKey,i.endKey),l=t.innerWidth()/o,c=r*l,h=t.innerHeight(),d=n*h,f=0;for(a=i.startKey;i.endKey>=a;a++)s=u.isBlackKey(a),e("<div></div>").css({position:"absolute",width:(s?c:l)+"px",height:(s?d:h)+"px",top:"0px",left:(s?f-c/2:f)+"px",zIndex:s?i.zIndex+1:i.zIndex}).addClass(i.cssPrefix+"-key").addClass(i.cssPrefix+(s?"-black-key":"-white-key")).attr("data-value",a).appendTo(t),s||(f+=l)},h=function(t){return parseInt(e(t).data("value"),10)},d=function(e){var t=u.getOrCreate(e.delegateTarget),i=h(e.target),s=t.getSelectedValues(),r=s.indexOf(i);switch(t.options.selectionMode){case"single":s=-1===r?[i]:[];break;case"multiple":-1===r?s.push(i):s.splice(r,1);break;default:s=[]}t.setSelectedValues(s)},u=function(t,i){this.options=e.extend({},u.defaults,i),this.$el=e(t),this.$el.data(a,this),l(this.$el,this.options),c(this.$el,this.options)};u.prototype.destroy=function(){this.$el.removeData(a),this.$el.removeClass(this.options.cssPrefix+"-container"),this.$el.off("."+a),this.$el.empty(),this.$el=null},u.prototype.getSelectedValues=function(){return this.$el.find("."+this.options.cssPrefix+"-selected-key").get().map(function(e){return h(e)})},u.prototype.setSelectedValues=function(t){this.$el.find("."+this.options.cssPrefix+"-key").each(function(i,s){var r=-1!==t.indexOf(h(s));e(s).toggleClass(this.options.cssPrefix+"-selected-key",r)}.bind(this))},u.getOrCreate=function(t,i){return e(t).data(a)||new u(t,i)},u.isBlackKey=function(e){var t=e%12;return-1!==o.indexOf(t)},u.getWhiteKeyCount=function(e,t){var i,s=0;for(i=e;t>=i;i++)u.isBlackKey(i)||(s+=1);return s},u.validateOptions=function(e){if(e.endKey<=e.startKey)throw Error("The end key must be greater than the start key.");if(i>e.startKey||e.endKey>s)throw Error("The key values must be grater than or equal to "+i+" and less than or euqal to "+s+".");if(u.isBlackKey(e.startKey))throw Error("The keyboard has to start with a white key.");if(u.isBlackKey(e.endKey))throw Error("The keyboard has to end with a white key.")},u.defaults={startKey:60,endKey:71,selectionMode:"multiple",cssPrefix:"klavier",zIndex:999},e.fn.klavier=function(e){var i=Array.prototype.slice.call(arguments,1);if("string"==typeof e){var s=this.get().map(function(t){var s=u.getOrCreate(t),r=s[e].apply(s,i);return r});return s.length?s[0]:t}return this.each(function(){u.getOrCreate(this,e)})},e.fn.klavier.defaults=u.defaults,e.fn.klavier._constructor=u})(jQuery);